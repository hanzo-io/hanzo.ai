import cookies from 'es-cookies';
import md5 from 'es-md5';

// src/cookie-storage.coffee
var cookieStorage = (function() {
  var key, postFix;
  postFix = md5(window.location.host);
  key = function(k) {
    return k + "_" + postFix;
  };
  return {
    get: function(k) {
      return cookies.getJSON(key(k));
    },
    set: function(k, v) {
      var ks, ref;
      ks = (ref = cookies.getJSON(key('_keys'))) != null ? ref : [];
      ks.push(k);
      cookies.set(key('_keys'), ks);
      return cookies.set(key(k), v);
    },
    remove: function(k) {
      return cookies.remove(key(k));
    },
    clear: function() {
      var i, k, ks, len, ref;
      ks = (ref = cookies.getJSON(key('_keys'))) != null ? ref : [];
      for (i = 0, len = ks.length; i < len; i++) {
        k = ks[i];
        cookies.remove(k);
      }
      return cookies.remove(key('_keys'));
    }
  };
})();

// src/storage.coffee
var storage = function(backend) {
  var root, store;
  root = typeof window === 'undefined' ? global : window;
  store = root[backend + 'Storage'];
  return {
    get: function(k) {
      var err;
      try {
        return JSON.parse(store.getItem(k));
      } catch (error) {
        err = error;
        console.error('Unable to parse', k);
        return void 0;
      }
    },
    set: function(k, v) {
      return store.setItem(k, JSON.stringify(v));
    },
    remove: function(k) {
      return store.removeItem(k);
    },
    clear: function() {
      return store.clear();
    }
  };
};

// src/local-storage.coffee
var localStorage = storage('local');

// src/index.coffee
var supported;

supported = function(storage) {
  var err, ok, testStr;
  try {
    testStr = '__akasha__test__';
    storage.set(testStr, testStr);
    ok = (storage.get(testStr)) === testStr;
    storage.remove(testStr);
    return ok;
  } catch (error) {
    err = error;
    return false;
  }
};

var index = (function() {
  if (supported(localStorage)) {
    return localStorage;
  } else {
    return cookieStorage;
  }
})();

export default index;
//# sourceMappingURL=akasha.mjs.map
